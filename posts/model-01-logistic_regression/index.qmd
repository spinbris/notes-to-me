---
title: "Titanic Logistic Regression"
author: "Stephen Parton"
date: "2022-09-05"
categories: [code, analysis,titanic]

format: 
  html: 
    code-fold: true
---

![](thumbnail.jpg){width="215"}

## Summary

This analysis looks at the previously processed Titanic analysis, using logistic regression.

```{r}
#| context: setup
#| include: false


library(tidyverse)
library(skimr)



library(tidymodels)
tidymodels_prefer()

```

## Load Some Pre-prepared Kaggle Data

```{r}
#| warning: false
#| echo: true
#| message: false

#getwd()

all_proc <- read_rds("../../posts/post-with-code/artifacts/all_proc.rds")
train_split <- read_rds("../../posts/post-with-code/artifacts/train_split.rds")
recipe_base <- read_rds("../../posts/post-with-code/artifacts/recipe_base.rds")

```

## Models

### Logistic Regression- GLM

#### LR Model Spec

```{r}
lr_spec <-  
  logistic_reg() %>% 
  set_engine("glm")

lr_spec


```

#### LR Workflow

```{r}
lr_wflow <- 
  workflow() %>% 
  add_model(lr_spec) %>% 
  add_recipe(recipe_base)

lr_wflow

```

#### LR Fit Model

```{r}

lr_fit <- 
  lr_wflow %>% 
  last_fit(train_split)

#lr_fit

lr_final_metrics <- lr_fit %>% collect_metrics()
lr_final_metrics 
#show_notes(.Last.tune.result)
```

#### LR Predict

```{r}


lr_test_predictions <- lr_fit %>% collect_predictions()
lr_test_predictions
```

#### LR Performance on validation set

##### AUC Curve

```{r}



lr_test_predictions %>% 
  roc_curve(truth = survived,.pred_1,event_level="second") %>% 
  autoplot()

```

##### Confusion Matrix

```{r}

lr_test_predictions %>% 
  conf_mat(survived,.pred_class) %>% 
  autoplot(type = "heatmap")

```

#### LR Resampling

```{r}
#| message: false
#| warning: false

folds <- vfold_cv(training(train_split), strata = survived, v=10)
#folds

control <- control_resamples(save_pred = TRUE)

lr_fit_cv <- 
  lr_wflow %>% 
  fit_resamples(folds, control = control)

#show_best(lr_fit_cv,metric= "accuracy")

#lr_fit_cv
lr_metrics_resample <- collect_metrics(lr_fit_cv)
lr_metrics_resample

```
