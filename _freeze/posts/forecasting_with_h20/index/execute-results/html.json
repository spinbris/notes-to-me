{
  "hash": "995973b693e6580b3b60a499dd37db7f",
  "result": {
    "markdown": "---\ntitle: \"Forecasting Flight Passengers using H20\"\nauthor: \"Stephen J Parton\"\ndate: \"2022-12-16\"\ncategories: [code, analytics, flights, forecasting]\nwebsite:\n  sidebar:\n    style: \"docked\"\n    search: true\nformat: \n  html: \n    theme: litera\ntoc: true\ntoc-title: Contents\nnumber-sections: true\nnumber-depth: 3\ncode-fold: true\ncode-summary: \"Code\"\ncode-tools: true\nexecute: \n  echo: true\n  warning: false\n  error: false\nfreeze: true\ncache: true\n---\n\n\n## Introduction\n\nThis analyses is the first of a multi-part set of posts looking at forecasting on domestic Australian flight volumes by route in the period prior to when covid largely shut the industry down. Its intention is just to provide me with examples over the main models to save time on future projects.It is split into:\n\n1.  Some pre analysis (basic EDA analysis is not covered as already included in previous posts)\n\n2.  'Sequence' style models - ARIMA etc\n\n3.  ML style models - XGBoost etc including nesting and ensembling\n\n4.  Deep learning models (GLuonTS etc)\n\n5.  Summary of conclusions\n\nThis post is in relation to the part 4 - focussing on H20, usimg the modeltime package to connect. This post is actually using ML models, but will be expanded to include deep learning approaches\n\nit uses the modeltime H20 [documentation](https://business-science.github.io/modeltime.h2o/articles/getting-started.html)\n\n## Load Libraries\n\n\n::: {.cell hash='index_cache/html/libraries_9b12f7e4871ded36ad4a868c9b3bdc2c'}\n\n```{.r .cell-code}\nlibrary(tidymodels)\nlibrary(modeltime.h2o)\nlibrary(tidyverse)\nlibrary(timetk)\n```\n:::\n\n\n## Load Data\n\n\n::: {.cell hash='index_cache/html/data_0f466a68e439fd9e63f47cf00f71bfe2'}\n\n```{.r .cell-code}\ntop_x   <- 10\nstart   <- \"2001-01-01\"\nend     <- \"2019-07-01\"\nhorizon <-  \"1 year\"\n\ntop_routes_prep_df <- read_rds(\"./artifacts/top_routes_prep_df.rds\") %>%  \n  filter(route != \"BRISBANE-EMERALD\") %>% #dodgy for some reason\n  #rowid_to_column(var = \"id\") %>% \n  select(date,route,passenger_trips)\n\ntopx <- top_routes_prep_df %>% \n  group_by(route) %>% \n  summarise(passenger_trips = sum(passenger_trips)) %>% \n  ungroup() %>% \n  slice_max(passenger_trips, n=top_x) %>% \n  arrange(desc(passenger_trips)) %>% \n  select(route) %>% \n  pull() %>% \n  as.character()\n\ntopx %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n|x                    |\n|:--------------------|\n|MELBOURNE-SYDNEY     |\n|BRISBANE-SYDNEY      |\n|BRISBANE-MELBOURNE   |\n|GOLD COAST-SYDNEY    |\n|ADELAIDE-MELBOURNE   |\n|ADELAIDE-SYDNEY      |\n|MELBOURNE-PERTH      |\n|PERTH-SYDNEY         |\n|MELBOURNE-GOLD COAST |\n|BRISBANE-CAIRNS      |\n:::\n:::\n\n\n## Graph Plots for top routes (to save space)\n\nThese graphs include full history. Covid period will be excluded for future analysis (bit hard to predict that little black swan).\n\n\n::: {.cell hash='index_cache/html/graph_814b0a67f7365f51d9d8db0964cbd9db'}\n\n```{.r .cell-code}\ntop_routes_prep_df %>% \n  filter(route %in% topx) %>%\n  group_by(route) %>% \n  plot_time_series(\n    .date_var    = date,\n    .value       = passenger_trips/1000,\n    .facet_ncol  = 2,\n    .smooth      = F,\n    .interactive = F,\n    .title       = \"Passenger Trips(000) by Route\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/graph-1.png){width=960}\n:::\n:::\n\n\n\\## Split data\n\nData is split inot trainig and test sets. Test set is 12 months.\n\n\n::: {.cell hash='index_cache/html/split_899971179084f7f42a5d6bca49c565d2'}\n\n```{.r .cell-code}\ndata_tbl <- top_routes_prep_df %>% \n  filter(date %>% between_time(start,end))\n  \n\nsplits <- time_series_split(data_tbl, assess = horizon, cumulative = TRUE)\n\nrecipe_spec <- recipe(passenger_trips ~ ., data = training(splits)) %>%\n    step_timeseries_signature(date) \n\ntrain_tbl <- training(splits) %>% bake(prep(recipe_spec), .)\ntest_tbl  <- testing(splits)  %>% bake(prep(recipe_spec), .)\n\nmin(test_tbl$date)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2018-08-01\"\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}